mapboxgl.accessToken = 'pk.eyJ1IjoiYXJ2aW5pbnQiLCJhIjoiY2twaHkxYTRtMTYxdjJ3cDNkcnpsMjU4biJ9.6Sgq8I1-2QebttGyrGaNAA';

var geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1975,14.1735] 
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BAGONG KALSADA <br> BQRT Emmergency Number <br> <a href="tel:+639648756414"><b>CALL:09293495043</b></a>'
        
      }
    },
    
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.2022,14.1811]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MASILI <br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
     {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1982,14.1814]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SUCOL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1823,14.1777]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PANSOL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1660,14.2180]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BANADERO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1593,14.2270]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BANLIC<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1244,14.1938]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BARANDAL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1562,14.2053]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 1.(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1613,14.2118]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 2.(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1618,14.2098]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 3(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
        
        
        }
    },
    
    
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1644,14.2140]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 4(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1655,14.2109]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 5(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1607,14.2144]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 6(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1686,14.2116]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BRGY 7(POBLACION)<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1593,14.2270]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BANLIC<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
           
    
    
    
    
    
    
              {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1691,14.1887]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BUCAL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
               {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1632,14.1955]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'HALANG<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1327,14.1978]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BATINO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0991,14.1697]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BUBUYAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1399,14.2014]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PRINZA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1392,14.1905]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'TURBINA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1547,14.1903]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'LAMESA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1573,14.1742]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MAUNONG<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1453,14.1674]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SAIMSIM<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1517,14.1592]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'CAMALIGAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
      {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1646,14.1533]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PUTING LUPA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1390,14.1513]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MAKILING<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1168,14.1527]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'ULANGO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1132,14.1629]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'KAY-ANLOG<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1199,14.1788]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PUNTA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0847,14.1618]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'BUNGGO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0376,14.1573]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MABATO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1200,14.2077]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MAYAPA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1332,14.2130]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PACIANO RIZAL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1297,14.2276]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MAPAGONG<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1415,14.2232]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SAN CRISTOBAL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1102,14.1986]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'MAJADA LABAS<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1082,14.1882]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PALO ALTO<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1052,14.2027]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SIRANGLUPA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
    
                {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0712,14.1922]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'CANLUBANG<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
            {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1551,14.2016]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'REAL<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
         {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1641,14.2013]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'LECHERIA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
    
         {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1836,14.2194]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SAMPIRUHAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
    
    
         {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1785,14.2249]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'LOOC<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
  
{
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1745,14.2104]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SAN JOSE<br> BQRT Emmergency Number <br> 09293495043'
      }
    },


{
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1726,14.2159]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'SAN JUAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },

{
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1515,14.2133]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PARIAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },

{
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.1854,14.2152]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'PALINGON<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
  
       {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0679,14.1704]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'HORNALAN<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
  
       {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [121.0897,14.1734]	
      },
      'properties': {
        'title': 'CALAMBA CITY',
        'description': 'LAGUERTA<br> BQRT Emmergency Number <br> 09293495043'
      }
    },
  ]
  
};

var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v11',
  center: [121.1618,14.2098],
  zoom: 13
});

// add markers to map
geojson.features.forEach(function (marker) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add it to the map
  new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(
      new mapboxgl.Popup({ offset: 25 }) // add popups
        .setHTML(
          '<h3>' +
            marker.properties.title +
            '</h3><p>' +
            marker.properties.description +
            '</p>'
        )
    )
    .addTo(map);
});






var nav = new mapboxgl.NavigationControl();

var directions = new MapboxDirections({
accessToken: mapboxgl.accessToken,
unit: 'metric',
profile: 'mapbox/driving',
alternatives: 'false',
geometries: 'geojson'
});

map.scrollZoom.enable();
map.addControl(directions, 'top-right');

var clearances = {
'type': 'FeatureCollection',
'features': [
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.47426, 38.06673]
},
'properties': {
'clearance': "13' 2"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.47208, 38.06694]
},
'properties': {
'clearance': "13' 7"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.47184, 38.06694]
},
'properties': {
'clearance': "13' 7"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.60485, 38.12184]
},
'properties': {
'clearance': "13' 7"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.61905, 37.87504]
},
'properties': {
'clearance': "12' 0"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.55946, 38.30213]
},
'properties': {
'clearance': "13' 6"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.27235, 38.04954]
},
'properties': {
'clearance': "13' 6"
}
},
{
'type': 'Feature',
'geometry': {
'type': 'Point',
'coordinates': [-84.27264, 37.82917]
},
'properties': {
'clearance': "11' 6"
}
}
]
};

var obstacle = turf.buffer(clearances, 0.25, { units: 'kilometers' });

map.on('load', function (e) {
map.addLayer({
id: 'clearances',
type: 'fill',
source: {
type: 'geojson',
data: obstacle
},
layout: {},
paint: {
'fill-color': '#f03b20',
'fill-opacity': 0.5,
'fill-outline-color': '#f03b20'
}
});

//Create sources and layers for the returned routes.
//There will be a maximum of 3 results from the Directions API.
//We use a loop to create the sources and layers.
for (i = 0; i <= 2; i++) {
map.addSource('route' + i, {
type: 'geojson',
data: {
type: 'Feature'
}
});

map.addLayer({
id: 'route' + i,
type: 'line',
source: 'route' + i,
layout: {
'line-join': 'round',
'line-cap': 'round'
},
paint: {
'line-color': '#cccccc',
'line-opacity': 0.5,
'line-width': 13,
'line-blur': 0.5
}
});
}
});

directions.on('route', (e) => {
var reports = document.getElementById('reports');
reports.innerHTML = '';
var report = reports.appendChild(document.createElement('div'));
let routes = e.route;

//Hide all routes by setting the opacity to zero.
for (i = 0; i < 3; i++) {
map.setLayoutProperty('route' + i, 'visibility', 'none');
}

routes.forEach(function (route, i) {
route.id = i;
});

routes.forEach((e) => {
//Make each route visible, by setting the opacity to 50%.
map.setLayoutProperty('route' + e.id, 'visibility', 'visible');

//Get GeoJson LineString feature of route
var routeLine = polyline.toGeoJSON(e.geometry);

//Update the data for the route, updating the visual.
map.getSource('route' + e.id).setData(routeLine);

var collision = '';
var emoji = '';
var clear = turf.booleanDisjoint(obstacle, routeLine);

if (clear == true) {
collision = 'is good!';
detail = 'does not go';
emoji = '✔️';
report.className = 'item';
map.setPaintProperty('route' + e.id, 'line-color', '#74c476');
} else {
collision = 'is bad.';
detail = 'goes';
emoji = '⚠️';
report.className = 'item warning';
map.setPaintProperty('route' + e.id, 'line-color', '#de2d26');
}

//Add a new report section to the sidebar.
// Assign a unique `id` to the report.
report.id = 'report-' + e.id;

// Add the response to the individual report created above.
var heading = report.appendChild(document.createElement('h6'));

// Set the class type based on clear value.
if (clear == true) {
heading.className = 'title';
} else {
heading.className = 'warning';
}

heading.innerHTML = emoji + ' Route ' + (e.id + 1) + ' ' + collision;

// Add details to the individual report.
var details = report.appendChild(document.createElement('div'));
details.innerHTML =
'This route ' + detail + ' through an avoidance area.';
report.appendChild(document.createElement('hr'));
});
});



map.addControl(new mapboxgl.NavigationControl());	


map.addControl(
new mapboxgl.GeolocateControl({

positionOptions: {
enableHighAccuracy: true
},


// When active the map will receive updates to the device's location as it changes.
trackUserLocation: true,
// Draw an arrow next to the location dot to indicate which direction the device is heading.
showUserHeading: true
})
);  


